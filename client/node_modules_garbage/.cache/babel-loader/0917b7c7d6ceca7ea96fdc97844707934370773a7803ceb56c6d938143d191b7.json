{"ast":null,"code":"var _jsxFileName = \"D:\\\\SkillBridge\\\\client\\\\src\\\\components\\\\ChatSystem.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from \"react\";\nimport io from \"socket.io-client\";\nimport \"./ChatSystem.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst socket = io(\"http://localhost:5001\");\nconst ChatSystem = ({\n  currentUser,\n  chatPartnerId,\n  chatPartnerName,\n  roomId,\n  onClose\n}) => {\n  _s();\n  const [messages, setMessages] = useState([]);\n  const [currentMessage, setCurrentMessage] = useState(\"\");\n  const messagesEndRef = useRef(null);\n  useEffect(() => {\n    if (roomId) {\n      socket.emit(\"join_room\", roomId);\n    }\n\n    // Listen for messages\n    socket.on(\"receive_message\", data => {\n      setMessages(prev => [...prev, data]);\n    });\n\n    // Listen for history\n    socket.on(\"receive_history\", history => {\n      setMessages(history);\n    });\n    return () => {\n      socket.off(\"receive_message\");\n      socket.off(\"receive_history\");\n    };\n  }, [roomId]);\n  useEffect(() => {\n    scrollToBottom();\n  }, [messages]);\n  const scrollToBottom = () => {\n    var _messagesEndRef$curre;\n    (_messagesEndRef$curre = messagesEndRef.current) === null || _messagesEndRef$curre === void 0 ? void 0 : _messagesEndRef$curre.scrollIntoView({\n      behavior: \"smooth\"\n    });\n  };\n  const sendMessage = async () => {\n    if (currentMessage !== \"\") {\n      const messageData = {\n        room: roomId,\n        senderId: currentUser.id || currentUser.user_id,\n        receiverId: chatPartnerId,\n        author: currentUser.name,\n        message: currentMessage,\n        created_at: new Date().toISOString() // Optimistic update\n      };\n      await socket.emit(\"send_message\", messageData);\n      // setMessages((prev) => [...prev, messageData]); // Socket broadcasts back to sender too\n      setCurrentMessage(\"\");\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"chat-window shadow-xl\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-header bg-primary text-white p-3 flex justify-between items-center rounded-t-lg\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex items-center gap-2\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"w-2 h-2 bg-success rounded-full\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 62,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"font-bold\",\n          children: chatPartnerName || \"Chat\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 63,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 61,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: onClose,\n        className: \"text-white hover:text-slate-200\",\n        children: \"\\u2715\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 65,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-body p-4 bg-slate-50 h-[300px] overflow-y-auto\",\n      children: [messages.map((msg, index) => {\n        const isMe = msg.senderId === (currentUser.id || currentUser.user_id) || msg.author === currentUser.name;\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          className: `message-container flex ${isMe ? \"justify-end\" : \"justify-start\"} mb-3`,\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: `message-bubble max-w-[80%] p-3 rounded-lg text-sm ${isMe ? \"bg-primary text-white rounded-br-none\" : \"bg-white border text-slate-700 rounded-bl-none\"}`,\n            children: [/*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"m-0\",\n              children: msg.message\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 74,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              className: `text-[10px] block mt-1 ${isMe ? \"text-blue-100\" : \"text-slate-400\"}`,\n              children: new Date(msg.created_at).toLocaleTimeString([], {\n                hour: '2-digit',\n                minute: '2-digit'\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 75,\n              columnNumber: 25\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 73,\n            columnNumber: 21\n          }, this)\n        }, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 72,\n          columnNumber: 17\n        }, this);\n      }), /*#__PURE__*/_jsxDEV(\"div\", {\n        ref: messagesEndRef\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"chat-footer p-3 bg-white border-t flex gap-2\",\n      children: [/*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"text\",\n        value: currentMessage,\n        placeholder: \"Type a message...\",\n        className: \"flex-1 input-field text-sm\",\n        onChange: event => {\n          setCurrentMessage(event.target.value);\n        },\n        onKeyPress: event => {\n          event.key === \"Enter\" && sendMessage();\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: sendMessage,\n        className: \"btn btn-primary btn-sm px-4\",\n        children: \"\\u27A4\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 59,\n    columnNumber: 5\n  }, this);\n};\n_s(ChatSystem, \"0nwaJo+aTQPN3l+LM0sXoSW3eys=\");\n_c = ChatSystem;\nexport default ChatSystem;\nvar _c;\n$RefreshReg$(_c, \"ChatSystem\");","map":{"version":3,"names":["React","useState","useEffect","useRef","io","jsxDEV","_jsxDEV","socket","ChatSystem","currentUser","chatPartnerId","chatPartnerName","roomId","onClose","_s","messages","setMessages","currentMessage","setCurrentMessage","messagesEndRef","emit","on","data","prev","history","off","scrollToBottom","_messagesEndRef$curre","current","scrollIntoView","behavior","sendMessage","messageData","room","senderId","id","user_id","receiverId","author","name","message","created_at","Date","toISOString","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","map","msg","index","isMe","toLocaleTimeString","hour","minute","ref","type","value","placeholder","onChange","event","target","onKeyPress","key","_c","$RefreshReg$"],"sources":["D:/SkillBridge/client/src/components/ChatSystem.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\r\nimport io from \"socket.io-client\";\r\nimport \"./ChatSystem.css\";\r\n\r\nconst socket = io(\"http://localhost:5001\");\r\n\r\nconst ChatSystem = ({ currentUser, chatPartnerId, chatPartnerName, roomId, onClose }) => {\r\n  const [messages, setMessages] = useState([]);\r\n  const [currentMessage, setCurrentMessage] = useState(\"\");\r\n  const messagesEndRef = useRef(null);\r\n\r\n  useEffect(() => {\r\n    if (roomId) {\r\n        socket.emit(\"join_room\", roomId);\r\n    }\r\n\r\n    // Listen for messages\r\n    socket.on(\"receive_message\", (data) => {\r\n      setMessages((prev) => [...prev, data]);\r\n    });\r\n\r\n    // Listen for history\r\n    socket.on(\"receive_history\", (history) => {\r\n        setMessages(history);\r\n    });\r\n\r\n    return () => {\r\n      socket.off(\"receive_message\");\r\n      socket.off(\"receive_history\");\r\n    };\r\n  }, [roomId]);\r\n\r\n  useEffect(() => {\r\n    scrollToBottom();\r\n  }, [messages]);\r\n\r\n  const scrollToBottom = () => {\r\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\r\n  };\r\n\r\n  const sendMessage = async () => {\r\n    if (currentMessage !== \"\") {\r\n      const messageData = {\r\n        room: roomId,\r\n        senderId: currentUser.id || currentUser.user_id,\r\n        receiverId: chatPartnerId,\r\n        author: currentUser.name,\r\n        message: currentMessage,\r\n        created_at: new Date().toISOString(), // Optimistic update\r\n      };\r\n\r\n      await socket.emit(\"send_message\", messageData);\r\n      // setMessages((prev) => [...prev, messageData]); // Socket broadcasts back to sender too\r\n      setCurrentMessage(\"\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"chat-window shadow-xl\">\r\n      <div className=\"chat-header bg-primary text-white p-3 flex justify-between items-center rounded-t-lg\">\r\n        <div className=\"flex items-center gap-2\">\r\n            <span className=\"w-2 h-2 bg-success rounded-full\"></span>\r\n            <span className=\"font-bold\">{chatPartnerName || \"Chat\"}</span>\r\n        </div>\r\n        <button onClick={onClose} className=\"text-white hover:text-slate-200\">✕</button>\r\n      </div>\r\n      \r\n      <div className=\"chat-body p-4 bg-slate-50 h-[300px] overflow-y-auto\">\r\n        {messages.map((msg, index) => {\r\n            const isMe = msg.senderId === (currentUser.id || currentUser.user_id) || msg.author === currentUser.name;\r\n            return (\r\n                <div key={index} className={`message-container flex ${isMe ? \"justify-end\" : \"justify-start\"} mb-3`}>\r\n                    <div className={`message-bubble max-w-[80%] p-3 rounded-lg text-sm ${isMe ? \"bg-primary text-white rounded-br-none\" : \"bg-white border text-slate-700 rounded-bl-none\"}`}>\r\n                        <p className=\"m-0\">{msg.message}</p>\r\n                        <span className={`text-[10px] block mt-1 ${isMe ? \"text-blue-100\" : \"text-slate-400\"}`}>\r\n                            {new Date(msg.created_at).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}\r\n                        </span>\r\n                    </div>\r\n                </div>\r\n            );\r\n        })}\r\n        <div ref={messagesEndRef} />\r\n      </div>\r\n\r\n      <div className=\"chat-footer p-3 bg-white border-t flex gap-2\">\r\n        <input\r\n          type=\"text\"\r\n          value={currentMessage}\r\n          placeholder=\"Type a message...\"\r\n          className=\"flex-1 input-field text-sm\"\r\n          onChange={(event) => {\r\n            setCurrentMessage(event.target.value);\r\n          }}\r\n          onKeyPress={(event) => {\r\n            event.key === \"Enter\" && sendMessage();\r\n          }}\r\n        />\r\n        <button onClick={sendMessage} className=\"btn btn-primary btn-sm px-4\">➤</button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ChatSystem;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}